<!DOCTYPE html> 
<head>
    <title>Задание #5</title>
	<meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="stylet.css">
<body>
<p><b>Задание #5. Выбор и сохранение фракталов</b></p>
<p>На этой неделе добавим две новые функции к программе Fractal Explorer. Во первых, возможность отображения нескольких фракталов и выбор фрактала с помощью выпадающего списка. Во вторых, возможность сохранить текущее изображение фрактала в файл. Вот скриншот новой версии программы:</p>
<p><img src="lab4.png" alt="pastedGraphic.pdf" width="480" height="578" style="display: block; margin-left: auto; margin-right: auto;" /></p>
<p>В верхней части окна программы Fractal Explorer теперь будет два виджета для выбора фрактала, а внизу добавится кнопка "Save" для сохранения текущего изображения фрактала.</p>
<p>Так как теперь имеется несколько источников событий,  вы сможете практически изучить вопрос обработки событий от всех этих источников в одном ActionListener в вашем классе.</p>
<p><span><b>Поддержка отображения нескольких фракталов</b></span></p>
<p><span>Добавить к Fractal Explorer возможность прорисовки нескольких фракталов довольно легко, в частности потому, что у нас уже есть абстрактный класс </span><span>FractalGenerator</span><span> . На этой неделе вам предстоит добавить несколько фракталов к программе, и сделать выбор фрактала для отображения с помощью <i>выпадающего списка</i>. Это очень распространенный "прием” в проектировании пользовательского интерфейса (то есть способ взаимодействия  с пользователем часто используемый в различных пользовательских интерфейсах), так что человеку будет легко понять как с ним работать. Программный интерфейс Swing API реализует выпадающий список с помощью класса  </span><span>javax.swing.JComboBox</span><span>, и этот класс выдает событие </span><span>ActionEvent</span><span> при выборе нового элемента. Вот что нужно сделать:</span></p>
<p><span></span><span>Создайте новые реализации  </span><span>FractalGenerator</span><span>.</span></p>
<p><span>Первая – фрактал <i>треуголка</i>. Сохраните ее в файле </span><span>Tricorn.java</span><span>. Как и раньше, следует сделать класс наследник  </span><span>FractalGenerator</span><span>, и реализация его будет почти такая же, как реализация Мандельброта, за исключением двух отличий. Фактически, вы можете просто скопировать исходный код фрактала Мандельброта, и внести следующие изменения.</span></p>
<p><span></span><span>Уравнение теперь такое <i>z</i></span><span><i><sub>n</sub></i></span><span> = <i>z</i></span><span><i><sub>n</sub></i><sub>-1</sub><sup>2</sup></span><span> + <i>c</i>. Разница только в том, что на каждой итерации вычисляется комплексно сопряженное значение <i>z</i></span><span><i><sub>n</sub></i><sub>-1</sub></span><span>.</span>Начальный диапазон фрактала треуголка должен быть от (-2, -2) до (2, 2).</p>
<p><span>Второй фрактал, который надо сделать называется "Горящий Корабль", который в действительности выглядит как горящий корабль. Вот детали его реализации:</span></p>
<p><span></span><span>Уравнение для вычисления фрактала <i>z</i></span><span><i><sub>n</sub></i></span><span> = (|Re(<i>z</i></span><span><i><sub>n</sub></i><sub>-1</sub></span><span>)| + <i>i</i> |Im(<i>z</i></span><span><i><sub>n</sub></i><sub>-1</sub></span><span>)|)</span><span><sup>2</sup></span><span> + <i>c</i>. Другими словами, надо вычислять модуль компонента <i>z</i></span><span><i><sub>n</sub></i><sub>-1</sub></span><span> на каждой итерации. </span>Начальный диапазон фрактала от (-2, -2.5) до (2, 1.5).</p>
<p><span>Выпадающие списки Swing могут работать с коллекциями объектов, но объекты должны иметь метод </span><span>toString()</span><span>. Не забудьте в каждой реализации фракталов, реализовать метод </span><span>toString()</span><span> который возврщает имя фрактала, т.е. "Мандельброт", "Треуголка", и "Горящий корабль".</span></p>
<p><span></span><span>Вставить </span><span>JComboBox</span><span> в интерфейс не составляет труда. Используйте конструктор без аргументов, и метод </span><span>addItem(Object)</span><span> для добавления каждой реализации абстрактного класса </span><span>FractalGenerator</span><span>. Как уже говорилось в предыдущем параграфе, выпадающий список использует метод </span><span>toString()</span><span> объектов генераторов фракталов для отображения их имен.</span></p>
<p><span>Добавьте к пользовательскому интерфейсу, перед выпадающим списком, текстовое поле поясняющим роль выпадающего списка. Для этого создайте новый объект </span><span>JPanel</span><span>, добавьте в него объекты </span><span>JLabel</span><span> и  </span><span>JComboBox</span><span>, и затем поместите панель в позицию </span><span>NORTH</span><span> содержимого  </span><span>JFrame</span><span>. </span></p>
<p><span>Наконец, добавьте обработку событий выпадающего списка к реализации </span><span>ActionListener</span><span>. В обработчике следует проверить, что источником события является выпадающий список, и если это так, следует получить из виджета текущий выбранный элемент списка и установить текущий генератор фрактала. (Для этого используйте метод </span><span>getSelectedItem()</span><span>.) Не забудьте сбросить начальный диапазон отображения фрактала!</span></p>
<p style="text-align: left;"><span>Для того чтобы вы могли поверить свою работу, ниже приведены начальные изображения фракталов Треуголка и Горящий Корабль:</span></p>
<p align="center"><img src="tricorn.png" width="480" height="578" /><img src="ship.png" width="480" height="578" /></p>
<p><span><b>Сохранение изображения фрактала</b></span></p>
<p><span>Другая задача этой недели - сохранение текущего изображения фрактала на диск. Это может показаться вам сложнейшей задачей, но Java API имеет  средства, существенно ее упрощающие.</span></p>
<p><span></span><span>Во первых добавьте на экран программы кнопку "Сохранить изображение". Обе кнопки Сохранить и Сброс можно поместить в новый объект </span><span>JPanel</span><span>, и затем добавить его в область </span><span>SOUTH</span><span> объекта </span><span>JFrame</span><span>  программы, аналогично тому как раньше вы поступили с текстовым полем и выпадающим списком. (Замечание: не вставьте по ошибке одну и ту же панель в обоих местах, иначе вы получите весьма странный результат!)</span></p>
<p><span>Для кнопки Сохранить также надо предусмотреть обработку событий в  </span><span>ActionListener</span><span>. Кнопки Сохранить и Сброс должны иметь собственные значения команд (например, "save" и "reset"), для того чтобы обработчик мог их различить .</span></p>
<p><span></span><span>В обработчике  кнопки "Сохранить ", надо добавить выбор имени файла в котором будет сохранено изображение! Это можно очень просто сделать с помощью класса </span><span>javax.swing.JFileChooser</span><span>. Этот класс имеет метод </span><span>showSaveDialog()</span><span>, который вызывает диалоговое окно "Сохранить файл " в котором пользователь может указать имя сохраняемого файла. Методу нужно передать ссылку на объект </span><span>Component</span><span> который будет родительским окном диалога выбора файла; это нужно для того чтобы диалог центрировался относительно родительского окна. Подставьте в этот параметр ссылку на объект </span><span>JFrame</span><span>.</span></p>
<p><span>Метод возвращает значение типа </span><span>int</span><span>, которое определяет результат операции выбора файла. Если метод возвращает константу  </span><span>JFileChooser.APPROVE_OPTION,</span><span> можно продолжить операцию записи файла; иначе, пользователь отменил запрос, и надо просто вернуть управление. Если пользователь выбрал место для сохранения файла, его можно получить через метод </span><span>getSelectedFile()</span><span> который возвращает объект типа </span><span>File</span><span>.</span></p>
<p><span></span><span>Надо настроить диалог выбора файла так чтобы он сохранял только изображения PNG; так как это пока единственный поддерживаемый нами формат. Это делается с помощью класса  </span><span>javax.swing.filechooser.FileNameExtensionFilter</span><span>, вот таким образом:</span></p>
<pre>JFileChooser chooser = new JFileChooser();
FileFilter filter = new FileNameExtensionFilter("PNG Images", "png");
chooser.setFileFilter(filter);
chooser.setAcceptAllFileFilterUsed(false);</pre>
<p><span>Последняя строчка нужна для того чтобы нельзя было ввести файлы с другим расширением ( не ".png").</span><span>Если пользователь выбрал файл, следующий шаг сохранение изображения фрактала на диск! Это опять могло бы вызвать сложности, но Java снова предлагает для этого готовые функции. Класс </span><span>javax.imageio.ImageIO</span><span> предлагает простые операции загрузки и сохранения изображений; можно использовать метод </span><span>write(RenderedImage im, String formatName, File output)</span><span>. Формат файла будет "png". "RenderedImage" это просто экземпляр класса the</span><span>BufferedImage</span><span> и вашего компонента </span><span>JImageDisplay</span><span>. (Этот член класса должен иметь модификатор доступа public.)</span></p>
<p><span>Конечно, вы обратите внимание на то что метод </span><span>write()</span><span> может вызывать исключения, поэтому вы должны поместить вызов этого метода в блок </span><span>try/catch</span><span>  и обрабатывать потенциальные ошибки. Блок </span><span>catch</span><span> должен сообщать пользователю об ошибке с помощью диалогового окна. Для этого в Swing есть класс </span><span>javax.swing.JOptionPane</span><span> упрощающий процесс создания информационных диалогов, или диалогов требующих ответа да/нет. В нашем случае, надо использовать статический метод </span><span>JOptionPane.showMessageDialog(Component parent, Object message, String title, int messageType)</span><span>, с типом сообщения </span><span>JOptionPane.ERROR_MESSAGE</span><span>. Сообщение об ошибке можно получить, вызвав метод </span><span>getMessage()</span><span> объекта исключения, а заголовок должен иметь смысл, например "Нельзя сохранить изображение". Как и раньше, </span><span>JFrame</span><span> должен быть родительским компонентом, для того чтобы диалог правильно центрировался в рамке главного окна.</span></p>
<p><span>Закончив работу, опробуйте вашу программу в действии! Теперь вы можете изучить разные типы фракталов и увидеть, как они красивы,  вы так же можете сохранить то, что видите на диск. Проверьте ваши обработчики исключений записывая изображения в файлы которые уже существуют на диске или доступны только для чтения, или на устройства доступные только для чтения типа CD дисков. Или попробуйте сохранить файл с именем уже существующего каталога.</span></p>
<div align="center"><hr size="2" width="100%" noshade="noshade" align="center" /></div>
<p>Copyright (C) 2015, California Institute of Technology. All rights reserved.</p>
</body>
</html>