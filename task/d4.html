<!DOCTYPE html> 
<head>
    <title>Доп. задание #4</title>
	<meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="stylet.css">
<body>
<p><b>Дополнительное задание #4</b></p>
<p>В этом задании сосредоточимся на полезных технологиях и инструментах для проектирования. Это означает, что вам не придется писать код, но все таки нужно будет проделать достаточно много работы.</p>
<p><b>Надо начать работу в каталоге ...<tt>/lab4<span style="text-decoration: underline;">tmp</span></tt>.</b> ПОКА НЕ ИСПОЛЬЗУЙТЕ КАТАЛОГ <tt>lab4</tt>. (Причина этого выяснится позднее; вы должны будете сделать каталог <tt>lab4</tt> на одном из следующих шагов.) Просто скопируйте в этот временный каталог свои старые файлы, потому что они понадобятся вам снова.</p>
<p><b>Автоматизация процесса проектирования</b></p>
<p>На данный момент у нас есть всего несколько <tt>.java</tt> файлов, но уже становится не очень удобно компилировать файлы исходного кода, компилировать тесты, создавать документацию API, запускать тесты и просматривать их результаты, и т.д. К счастью, все эти задачи можно автоматизировать, так чтобы компиляция проекта не вызывала никаких сложностей.</p>
<p>Мы будем использовать <a href="http://ant.apache.org">Ant</a>. Он используется во многих проектах Java, и имеет огромный набор средств и возможностей. Более того, Ant разработан для запуска на разных платформах и не требует реконфигурации; например, он может преобразовывать символы "/" и "\" в зависимости от операционной системы в которой он запущен. Ant можно загрузить и установить на своем компьютере.</p>
<p><b>Структура проекта</b></p>
<p>Перед тем как начать автоматизацию процесса компиляции проекта, следует тщательно продумать структуру каталогов. Обычно, в проектах Ant имеются следующие каталоги:</p>
<dl><dt><tt>src</tt></dt><dd>Здесь располагается исходный код. Код для тестов не помещается в этот каталог!</dd><dt><tt>test</tt></dt><dd>Здесь располагается тестирующий код. Аналогично правилу для каталога <tt>src</tt>, здесь не должно быть файлов исходного кода проекта; только код тестов.</dd><dt><tt>lib</tt></dt><dd>Здесь помещаются внешние библиотеки (JAR-файлы) которые нужны для запуска программы, или запуска тестов. (Например, сюда следует поместить JAR-файл TestNG.)</dd><dt><tt>res</tt></dt><dd>Здесь расположены дополнительные ресурсы требующиеся вашей программе, включая картинки, варианты переводы текста, строки пользовательского интерфейса, и так далее.</dd><dt><tt>doc</tt></dt><dd>Здесь вы должны поместить документацию проекта, включая проектную документацию, руководства пользователя, сведения о релизах, списки багов (если вы не пользуетесь сторонней программой баг-трекером), и так далее. (Сейчас у вас скорее всего нет файлов, которые вы можете поместить в каталог <tt>doc</tt>.)</dd><dt><tt>build</tt></dt><dd>
<p>Этот каталог создается компилирующим скриптом, и все файлы создаваемые в процессе компиляции попадают в этот каталог. Так проще сделать цель "очистка". Для этого надо просто стереть этот каталог.</p>
<p>В каталоге <tt>build</tt>будут подкаталоги:</p>
<ul>
<li><tt>classes</tt> - куда помещаются созданные <tt>.class</tt> файлы</li>
<li><tt>javadoc</tt> - куда записывается документация API</li>
</ul>
</dd></dl>
<p>Реструктурируйте ваш код так чтобы он распределился по указанным каталогам. Пока достаточно создать каталоги <tt>src</tt>, <tt>test</tt>, и <tt>lib</tt>, и переписать в них файлы вашего проекта. Если у вас уже есть файлы с документацией (не-Javadoc), их можно поместить в каталог <tt>doc</tt>. Аналогично, если у вас есть файлы изображений или другие ресурсы, можете записать их в каталог <tt>res</tt>.</p>
<p>Не следует записывать <tt>.class</tt> класс файлы в каталог <tt>src</tt> или <tt>test</tt>, и записывать куда либо документацию Javadoc. Все это будет создано компилирующим скриптом и появится внутри каталога <tt>build</tt> во время компиляции.</p>
<p><b>Файл <tt>build.xml</tt></b></p>
<p>В этом задании можно начать с файла <tt>build.xml</tt>. (Я обычно сохраняю файл <tt>build.xml</tt> и использую его как шаблон, для каждого нового проекта.) Загрузите <a href="https://dl.dropboxusercontent.com/u/57328246/advjava/lab4/example-build.xml">этот файл <tt>example-build.xml</tt></a> в свой каталог четвертого задания <tt>lab4</tt>, и переименуйте его в <tt>build.xml</tt>.</p>
<p>Просмотрите содержимое этого файла, и изучите правила по которым он составлен. Самое важное обстоятельство, это то что все важные для нас каталоги заданы в виде свойств Ant в самом начале файла, и подкаталоги задаются через свойства каталогов. Например, есть свойство <tt>buildDir</tt>, и после объявлено свойство <tt>buildClassesDir</tt> -подкаталог в определении которого подставлено свойство <tt>buildDir</tt>.</p>
<p>Для того чтобы можно было откомпилировать ваш проект сделайте следующее:</p>
<ol>
<li>
<p><b>Измените имя и описание проекта в файле <tt>build.xml</tt>.</b> Имя проекта должно быть просто "boggle". Описание должно отражать общую идею проекта и то как его компилировать.</p>
<p>Результат своей работы можно увидеть выполнив команду "<tt>ant -projecthelp</tt>" в командной строке.</p>
</li>
<li>
<p>Добавьте цель <tt>clean</tt> к своему Ant файлу, которая удаляет каталог build и все его содержимое. Добавьте к цели понятное описание. (Подсказка: см. задачу Ant <tt>delete</tt>. Эта цель должна быть очень проста.)</p>
<p><em>Сделайте архивную копию вашей работы прежде чем компилировать цель!</em></p>
</li>
<li>
<p><b>Добавьте цель <tt>javadoc</tt> к Ant файлу, которая использует задачу <tt>javadoc</tt> Ant для генерации документации API в каталоге заданном свойством <tt>javaDocDir</tt>.</b> Снова сделайте понятное описание цели. Задайте все каталоги с помощью свойств Ant; не вписывайте каталоги прямо в задачу, так как они почти наверняка потом изменятся.</p>
<p>(Вы можете добавить или исключить свои тестовые классы в Javadocs. Я обычно не включаю тестовый код в Javadocs, потому, что он имеет тенденцию захламлять этот ресурс предназначенный для помощи разработчикам.)</p>
<p>Вот еще несколько деталей для реализации вашей цели <tt>javadoc</tt>:</p>
<ul>
<li>Цель должна иметь зависимость от цели <tt>-init</tt>.</li>
<li>Я обычно устанавливаю атрибуты <tt>author</tt>, <tt>version</tt>, и <tt>private</tt> в <tt>"true"</tt>, потому что это полезная для вывода информация.</li>
<li>Целевой каталог (атрибут <tt>destdir</tt> attribute) должен иметь значение свойства <tt>javaDocDir</tt> Ant.</li>
<li>Чтобы задать файлы исходного кода, можно использовать вложенный элемент <tt>&lt;fileset&gt;</tt>, примерно так:
<pre>    &lt;fileset dir="${srcDir}" /&gt;</pre>
</li>
</ul>
</li>
</ol>
<p>После того, как все эти задачи выполнены, проверьте как компилируется ваша программа и генерируется для нее документация API. Для этого запустите различные задачи Ant. Например:</p>
<pre>    ant clean
    ant compile
    ant clean compile javadoc</pre>
<p><b>Использование TestNG совместно с Ant</b></p>
<p>Так как TestNG это новый инструмент, Ant не имеет встроенных задач для запуска тестов TestNG! Но это не страшно, так как Ant имеет способ добавления новых типов задач к build-файлу проекта. Для этой цели используется тэг <tt>&lt;taskdef&gt;</tt>.</p>
<p>Добавьте эти строки к файлу <tt>build.xml</tt>, после путей к каталогам и перед "Целями(Build Targets)":</p>
<pre>    &lt;taskdef resource="testngtasks"
             classpath="<em>path/to/testng.jar</em>" /&gt;</pre>
<p>Как обычно, используйте свойство Ant чтобы указать путь к JAR-файлу TestNG.</p>
<p>Как только вы это сделали, задачу <tt>&lt;testng&gt;</tt> можно использовать в вашем проекте. Документацию по этому вопросу можно найти <a href="http://testng.org/doc/ant.html">на сайте TestNG</a>. Включите свои модульные тесты в процедуру создания проекта сделав следующее:</p>
<ol>
<li>
<p><b>Добавьте новую цель с именем <tt>compile-tests</tt>.</b> Начать можно с копирования цели <tt>compile</tt>. Однако, обязательно внесите в копию следующие изменения:</p>
<ul>
<li>Цель <tt>compile-tests</tt> имеет зависимость от цели <tt>compile</tt>, так как (это очевидно) тесты используют классы проекта.</li>
<li>Файлы исходного кода тестов располагаются в <tt>testSrcDir</tt>, а не в <tt>srcDir</tt>.</li>
<li>class-файлы тестов должны помещаться в <tt>testBuildDir</tt>, а не в <tt>buildClassesDir</tt>.</li>
<li>Путь к файлам классов должен быть <tt>test.path</tt>, а не <tt>libs.path</tt>. Так же не забудьте изменить свойство <tt>test.path</tt> так чтобы оно показывало на JAR-файл TestNG, который должен располагаться в каталоге <tt>libDir</tt>.</li>
<li>Дайте новой цели подходящее описание.</li>
</ul>
</li>
<li>
<p><b>Добавьте новую цель <tt>test</tt> в свой Ant файл. Она должна запускать все модульные тесты с помощью задачи <tt>testng</tt>.</b> Как обычно, напишите понятное описание цели. Вот еще несколько деталей которые помогут вам завершить создание цели:</p>
<ul>
<li>Эта цель имеет зависимость от задачи <tt>compile-tests</tt>.</li>
<li>Вашей ели нужна только одна задача, <tt>testng</tt>.</li>
<li>Задайте атрибут <tt>suitename</tt>, потому что значение по умолчанию "Ant suite" слишком громкое. Укажите что то вроде "boggle-tests".</li>
<li>Результаты тестов должны попасть в каталог <tt>testResultsDir</tt> . (См. свойство <tt>outputdir</tt>.)</li>
<li>
<p>classpath для задачи <tt>testng</tt> указывается одним из трех способов; можно указать атрибут <tt>classpath</tt>, или атрибут <tt>classpathref</tt> , или добавить вложенный элемент <tt>&lt;classpath&gt;</tt>. Одно тонкое место здесь, это то что test-path не содержит путь к откомпилированным тестовым классам. Поэтому нужно указать что то вроде этого:</p>
<pre>    &lt;classpath&gt;
      &lt;path refid="test.path" /&gt;
      &lt;pathelement path="${testBuildDir}" /&gt;
    &lt;/classpath&gt;</pre>
<p>Другими словами, мы включаем путь <tt>test.path</tt>, и затем еще добавляем содержимое <tt>testBuildDir</tt>.</p>
</li>
<li>Наконец надо задать список запускаемых тестовых классов. Для этого можно использовать вложенный элемент &lt;classfileset&gt;.</li>
</ul>
</li>
</ol>
<p>Когда вы закончили с целями <tt>compile-tests</tt> и <tt>test</tt>, запустите их и посмотрите как они работают. Если все в порядке, можете открыть каталог <tt>build/results</tt> и посмотреть простой HTML отчет ваших модульных тестов.</p>
<p><b>Полная автоматизация компиляции проекта</b></p>
<p>После того как все ваши цели заработали, раскомментируйте цель <tt>full</tt>, и измените цель по умолчанию вашего проекта на <tt>full</tt>. Теперь если вы запустите <tt>ant</tt> без аргументов, он запустит цель <tt>full</tt> все ее зависимости.</p>
<p><b>Контроль версий с помощью Subversion</b></p>
<p>Теперь ваш проект имеет гораздо лучшую структуру, и теперь когда процесс компиляции автоматизирован, вы можете настроить репозиторий для управления файлами исходного кода проекта. Вы уже сделали большую часть работы, осталось сделать несколько относительно простых шагов.</p>
<p>Поместите ваш проект в репозиторий Subversion кафедры. Есть несколько способов сделать это. Возможно проще всего использовать клент Subversion с графическим интерфейсам. Правила работы с одним из таких клиентов для Windows описаны <a href="https://moodle.iu3.bmstu.ru/course/view.php?id=106"> в этом документе</a>. В раздеде Subversion есть ссылки на графические клиенты для Linux и Mac OS. Если вы предпочитаете работать в командной строке Linux, изучите приведенные ниже инструкции. </p>
<p>В ответе на это задание не нужно загружать в Moodle какие либо файлы. Следует только указать путь к вашему проекту в репозитории Subvresion, например:</p>
<pre> /ivans/java-course/boggle</pre>
<pre>Клиент Subversion в командной строке Linix</pre>
<p>Есть несколько способов подключиться к серверу Subversion из командной строки Linux. Здесь описан способ подключения по протоколу HTTPS. На практике удобнее использовать svn+ssh, но наш сервер не поддерживает этот протокол. Следует отметить6 что если соединение огранизуется по HTTP, то надо использовать защищенную версию этого протокола, чтобы пароли и имена пользователей не передавались открытым текстом. Так сделано и в нашем случае.</p>
<ol>
<li> Напервом этапе обычно создается новый репозиторий Subversion. Это делается командой <tt>svnadmin create на сервере, например:</tt>
<pre>    svnadmin create ~/home/joe/advjava/svnrepo</pre>
 Но, в данном случае вам надо поместить файлы в отдельный каталог уже созданного репозитория. Поэтому этот шаг следует пропустить и перейти к импорту проекта.</li>
<li>Импортируйте все файлы исходного кода в репозиторий Subversion. Ваши файлы уже хорошо структурированы, но нужно удалить все результаты компиляции ( с помощью <tt>ant clean</tt>), а также удалить временные файлы редактора, такие как <tt>*~</tt>, и пр.</li>
<li>
<p>Когда ваши файлы подготовлены для импорта, выполните его командой <tt>svn import</tt>.  (Можно также импортировать удаленный репозиторий командой <tt>svn+ssh://</tt> URL, но с этим если хотите разберитесь сами .) Выполните эту команду в каталоге <tt>lab4tmp</tt>:</p>
<pre>    svn import https://&lt;имя хоста&gt;/svn/<em>&lt;имя пользователя&gt;</em>/advjava/boggle --trust-server-cert --non-interactive -m "&lt;сообщение&gt;" --username &lt;имя пользователя&gt; --password &lt;пароль&gt;</pre>
<p><em>(Конечно, замените <tt>&lt;имя пользователяe&gt;</tt> на ваше имя пользователя под которым вы зарегистрированы на этом сайте, &lt;имя хоста&gt; на <a href="https://moodle.iu3.bmstu.ru/mod/page/view.php?id=833">имя сервера Subversion</a>, &lt;пароль&gt; на ваш пароль от сервера Subversion /как его получить см. <a href="https://moodle.iu3.bmstu.ru/mod/page/view.php?id=833">сдесь</a>./ &lt;сообщение&gt; можно оставить пустым "" или ввести строку поясняющую ваше действие. Наример "импорт проекта". Это сообщение будет сохранено сервером Subversion. Если убрать ключ -m из командной строки то перед исполненим команды появится окно редактора в котором нужно будет вести эту поясняющую строку)</em></p>
<p>Эта команда рекурсивно импортирует <em>все</em> файлы из вашего локального каталога, в репозиторий. "<tt>boggle</tt>" в конце URL репозитория означает, что ваш проект будет помещен в каталог "boggle" репозитория.</p>
<p>Не удаляйте локальные файлы до тех пор, пока не убедитесь, что импорт успешно завершен! Не следует терять результат тяжелой работы.</p>
<p>Если Subversion сообщит о том что не может найти редактор, можете вылечить это например такой командой: <tt>export EDITOR=vi</tt> перед тем, как выполнять команды Subversion. (Замените <tt>vi</tt> именем своего любимого текстового редактора.)</p>
</li>
<li>
<p>Импорт файлов из каталоге <em>не</em> делает этот каталог автоматически рабочей копией репозитория! Поэтому после импорта, нужно загрузить (эта операция называется checkout) файлы из репозитория в локальный каталог. Так можно к тому же проверить что импорт прошел успешно. Создайте новый каталог <tt>~/cs11/advjava/lab4</tt>, и сделайте checkout в этот каталог. Примерно так:</p>
<code>svn checkout https://&lt;имя хоста&gt;/svn/<em>&lt;имя пользователя&gt;</em>/advjava/boggle --trust-server-cert --non-interactive --username &lt;имя пользователя&gt; --password &lt;пароль&gt;</code>
<p>Эта команда создаст локальный каталог <tt>boggle</tt>, содержащий файлы которые вы только что импортировали. Проверьте что там есть все файлы которые вы рассчитывали найти! Когда вы убедитесь что все в порядке, <em>тогда</em> можете стереть временный каталог <tt>lab4tmp</tt>.</p>
</li>
</ol>
<p>После того, как все это сделано, можно редактировать рабочую копию проекта не трогая исходный код в репозитории. Можно компилировать и тестировать код копии и после того как все с ним станет хорошо, можно выгрузить (операция commit) его обратно в репозиторий.</p>
<p>Команду <tt>svn commit</tt> можно вызывать без параметров не указывая URL репозитория потому, что Subversion создает небольшие файлы <tt>.svn</tt> в каталоге рабочей копии, которые содержат всю необходимую информацию включая имя репозитория. (Их можно увидеть командой "<tt>ls -a</tt>" в каталоге рабочей копии.)</p>
<p>Вы можете использовать команды <tt>svn help</tt> и <tt>svnadmin help</tt> чтобы получить дополнительную информацию о командах Subversion.</p>
<p>Вот несколько интересных задач, которые вы можете попробовать решить, если хотите лучше изучить Ant и Subversion.</p>
<ul>
<li>
<p>Начиная с Java 1.4, инструмент Javadoc позволяет вам добавлять собственные тэги Javadoc к вашей документации. Я <em>часто</em> использую это свойство для того чтобы улучшить документацию своих проектов:</p>
<pre>    /**
     * Мой прекрасный класс генератор виджетов.
     *
     * <b>@todo Убедится что все виджеты работают!</b>
     **/
    public class WidgetGenerator {
        ...
    }</pre>
<p>В этом случае, тэг Javadoc <tt>@todo</tt> не относится к набору стандартных тэгов Javadoc (хотя он есть в списке предлагаемых новых тегов). Однако его можно добавить к генерируемым тегам правильно настроив инструмент Javadoc. Так как вы используете Ant, эта настройка делается просто. Задача Ant <tt>javadoc</tt> поддерживает вложенные элементы <tt>&lt;tag&gt;</tt>, например такие:</p>
<pre>    &lt;javadoc ...&gt;
        ...

        &lt;tag name="todo" description="To Do:" /&gt;
    &lt;/javadoc&gt;</pre>
Добавьте следующие тэги Javadoc:
<ul>
<li><tt>@todo <em>bla bla bla</em></tt> - описывает что нужно доделать в будущем</li>
<li><tt>@design <em>bla bla bla</em></tt> - описывает проектные решения и намерения</li>
<li><tt>@review <em>(user) bla bla bla</em></tt> - когда вы просматриваете чей то код, вы можете оставить комментарий описывающий какую то особенность или проблему в коде</li>
</ul>
</li>
<li>
<p>Посмотрите свойство <tt>svn:ignore</tt> в документации Subversion. Это свойство можно установить для любого каталога; оно позволяет указать список файлов и подкаталогов которые Subversion игнорирует выполняя свои операции. Вернитесь в корневой каталог проекта Boggle и добавьте каталог <tt>build</tt> к свойству <tt>svn:ignore</tt>. (Подсказка: см. <tt>svn propedit</tt>)</p>
<p>Можете проверить свою работу командой <tt>svn status</tt> в корневом каталоге после завершения компиляции; если каталог <tt>build</tt> игнорируется все сделано правильно.</p>
</li>
</ul>
<div align="center"><hr size="2" width="100%" noshade="noshade" align="center" /></div>
<p>Copyright (C) 2015, California Institute of Technology. All rights reserved.</p>
</body>
</html>